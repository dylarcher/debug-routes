<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CapitalRx Route Debugger Report</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #0071b3;
            border-bottom: 3px solid #0071b3;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .summary-card {
            background: linear-gradient(135deg, #0071b3, #005a8b);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .summary-card h3 {
            margin: 0 0 10px 0;
            font-size: 2em;
        }
        .summary-card p {
            margin: 0;
            opacity: 0.9;
        }
        .issue {
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            border-left: 5px solid;
        }
        .issue.high {
            background: #ffebee;
            border-left-color: #f44336;
        }
        .issue.medium {
            background: #fff8e1;
            border-left-color: #ff9800;
        }
        .issue.low {
            background: #e8f5e8;
            border-left-color: #4caf50;
        }
        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .issue-type {
            background: rgba(0, 0, 0, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-family: monospace;
        }
        .issue-file {
            font-family: monospace;
            color: #666;
            font-size: 0.9em;
        }
        .fix-suggestion {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
        }
        .recommendation {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
        }
        .dependencies {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        .dependency {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #28a745;
        }
        .dependency.critical {
            border-left-color: #dc3545;
        }
        .dependency.not-detected {
            border-left-color: #ffc107;
            opacity: 0.7;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            border-bottom-color: #0071b3;
            color: #0071b3;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .code {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        .debug-tools {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
        }
        .debug-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .debug-button:hover {
            background: #2980b9;
        }
        .monitor {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            z-index: 10000;
            max-width: 350px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß CapitalRx Route Debugger Report</h1>
        <p><strong>Generated:</strong> 8/26/2025, 4:26:54 PM</p>
        <p><strong>Analyzed Path:</strong> <code>/Users/dylanarcher/vm/dev/mnt/code.capitalrx.com/pa.capitalrx.com</code></p>

        <div class="summary-grid">
            <div class="summary-card">
                <h3>6</h3>
                <p>Files Analyzed</p>
            </div>
            <div class="summary-card">
                <h3>4</h3>
                <p>Total Issues</p>
            </div>
            <div class="summary-card">
                <h3>2</h3>
                <p>Files with Issues</p>
            </div>
            <div class="summary-card">
                <h3>0</h3>
                <p>High Severity</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('issues')">üö® Issues</button>
            <button class="tab" onclick="showTab('recommendations')">üí° Recommendations</button>
            <button class="tab" onclick="showTab('dependencies')">üì¶ Dependencies</button>
            <button class="tab" onclick="showTab('debug')">üõ† Debug Tools</button>
        </div>

        <div id="issues" class="tab-content active">
            <h2>Issues Found</h2>
            
      <div class="issue medium">
        <div class="issue-header">
          <span>‚ö†Ô∏è <strong>Shell hooks used without proper memoization</strong></span>
          <span class="issue-type">unmemoized-shell-hooks</span>
        </div>
        <div class="issue-file">üìÑ frontend/src/hooks/useReRoute.ts</div>
        
        <div class="fix-suggestion">üí° <strong>Fix:</strong> Wrap shell hooks with useMemo/useCallback for stability</div>
      </div>
    
      <div class="issue medium">
        <div class="issue-header">
          <span>‚ö†Ô∏è <strong>QueryClient created in route file - may cause state loss</strong></span>
          <span class="issue-type">query-client-creation</span>
        </div>
        <div class="issue-file">üìÑ frontend/src/routes/PARoutes.tsx</div>
        
        <div class="fix-suggestion">üí° <strong>Fix:</strong> Move QueryClient creation to module level or share instance</div>
      </div>
    
      <div class="issue medium">
        <div class="issue-header">
          <span>‚ö†Ô∏è <strong>ActivityContext found - may track navigation changes</strong></span>
          <span class="issue-type">activity-context</span>
        </div>
        <div class="issue-file">üìÑ frontend/src/routes/PARoutes.tsx</div>
        
        <div class="fix-suggestion">üí° <strong>Fix:</strong> Review ActivityContext usage for potential navigation interference</div>
      </div>
    
      <div class="issue medium">
        <div class="issue-header">
          <span>‚ö†Ô∏è <strong>Shell hooks used without proper memoization</strong></span>
          <span class="issue-type">unmemoized-shell-hooks</span>
        </div>
        <div class="issue-file">üìÑ frontend/src/routes/PARoutes.tsx</div>
        
        <div class="fix-suggestion">üí° <strong>Fix:</strong> Wrap shell hooks with useMemo/useCallback for stability</div>
      </div>
    
        </div>

        <div id="recommendations" class="tab-content">
            <h2>Recommendations</h2>
            
      <div class="recommendation">
        üí° <strong>[MEDIUM] Multiple medium-severity issues detected</strong>
        <br><em>Action: Consider refactoring route structure for better stability</em>
        
      </div>
    
        </div>

        <div id="dependencies" class="tab-content">
            <h2>Dependency Analysis</h2>
            
      <div class="dependencies">
        
          <div class="dependency critical ">
            <h4>react-router</h4>
            <p><strong>Version:</strong> 6.x</p>
            <p><strong>Critical:</strong> Yes</p>
            <p><strong>Detected:</strong> ‚úÖ Yes</p>
            
            
          </div>
        
          <div class="dependency critical ">
            <h4>react-router-dom</h4>
            <p><strong>Version:</strong> 6.x</p>
            <p><strong>Critical:</strong> Yes</p>
            <p><strong>Detected:</strong> ‚úÖ Yes</p>
            
            <p><strong>Components:</strong> BrowserRouter, Routes, Route, Navigate, useNavigate, useLocation</p>
          </div>
        
          <div class="dependency  not-detected">
            <h4>@tanstack/react-query</h4>
            <p><strong>Version:</strong> 5.x</p>
            <p><strong>Critical:</strong> No</p>
            <p><strong>Detected:</strong> ‚ùå No</p>
            <p><strong>Issue:</strong> Multiple QueryClient instances may cause state loss</p>
            
          </div>
        
          <div class="dependency critical ">
            <h4>capitalrx-shell</h4>
            <p><strong>Version:</strong> latest</p>
            <p><strong>Critical:</strong> Yes</p>
            <p><strong>Detected:</strong> ‚úÖ Yes</p>
            
            <p><strong>Components:</strong> Shell, AsyncWrapper, useModulePathResolver, ShellSwitch</p>
          </div>
        
      </div>
    
        </div>

        <div id="debug" class="tab-content">
            <h2>Interactive Debug Tools</h2>
            
      <div class="debug-tools">
        <h3>üõ† Live Debugging Tools</h3>
        <p>Use these tools to debug routing issues in real-time when this page is loaded in your application.</p>

        <button class="debug-button" onclick="startRouteMonitor()">Start Route Monitor</button>
        <button class="debug-button" onclick="stopRouteMonitor()">Stop Route Monitor</button>
        <button class="debug-button" onclick="injectDebugUtilities()">Inject Debug Utils</button>
        <button class="debug-button" onclick="analyzeCurrentRoute()">Analyze Current Route</button>
        <button class="debug-button" onclick="exportDebugData()">Export Debug Data</button>

        <div id="debug-output" style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 4px; font-family: monospace; font-size: 12px;"></div>
      </div>
    
        </div>
    </div>

    <div id="monitor" class="monitor">
        <div id="monitor-content"></div>
    </div>

    <script>
        // Data for client-side debugging
        window.routeDebugData = {
  "issues": [
    {
      "type": "unmemoized-shell-hooks",
      "severity": "medium",
      "file": "frontend/src/hooks/useReRoute.ts",
      "message": "Shell hooks used without proper memoization",
      "fix": "Wrap shell hooks with useMemo/useCallback for stability"
    },
    {
      "type": "query-client-creation",
      "severity": "medium",
      "file": "frontend/src/routes/PARoutes.tsx",
      "message": "QueryClient created in route file - may cause state loss",
      "count": 1,
      "fix": "Move QueryClient creation to module level or share instance"
    },
    {
      "type": "activity-context",
      "severity": "medium",
      "file": "frontend/src/routes/PARoutes.tsx",
      "message": "ActivityContext found - may track navigation changes",
      "fix": "Review ActivityContext usage for potential navigation interference"
    },
    {
      "type": "unmemoized-shell-hooks",
      "severity": "medium",
      "file": "frontend/src/routes/PARoutes.tsx",
      "message": "Shell hooks used without proper memoization",
      "fix": "Wrap shell hooks with useMemo/useCallback for stability"
    }
  ],
  "recommendations": [
    {
      "priority": "medium",
      "message": "Multiple medium-severity issues detected",
      "action": "Consider refactoring route structure for better stability"
    }
  ],
  "dependencies": {
    "react-router": {
      "version": "6.x",
      "critical": true,
      "shellPatched": true,
      "patchedComponents": [
        "Switch -> ShellSwitch"
      ],
      "detected": true
    },
    "react-router-dom": {
      "version": "6.x",
      "critical": true,
      "components": [
        "BrowserRouter",
        "Routes",
        "Route",
        "Navigate",
        "useNavigate",
        "useLocation"
      ],
      "detected": true
    },
    "@tanstack/react-query": {
      "version": "5.x",
      "critical": false,
      "issue": "Multiple QueryClient instances may cause state loss",
      "detected": false
    },
    "capitalrx-shell": {
      "version": "latest",
      "critical": true,
      "components": [
        "Shell",
        "AsyncWrapper",
        "useModulePathResolver",
        "ShellSwitch"
      ],
      "detected": true
    }
  },
  "routeConfigs": [
    {
      "file": "frontend/src/hooks/useReRoute.ts",
      "hasActivityContext": false,
      "hasBlockedNavigation": false,
      "hasMultipleQueryClients": false,
      "hasUnmemoizedRoutes": false,
      "hasReactRouter": true,
      "hasShellComponents": true,
      "componentCount": 1,
      "imports": [
        "react",
        "react-router-dom",
        "capitalrx-shell",
        "@/helpers"
      ]
    },
    {
      "file": "frontend/src/pages/LetterTemplate/LegacyLetterRoutes.tsx",
      "hasActivityContext": false,
      "hasBlockedNavigation": false,
      "hasMultipleQueryClients": false,
      "hasUnmemoizedRoutes": false,
      "hasReactRouter": true,
      "hasShellComponents": false,
      "componentCount": 0,
      "imports": [
        "react",
        "react-router",
        "@/components",
        "@/constants"
      ]
    },
    {
      "file": "frontend/src/routes/PARoutes.tsx",
      "hasActivityContext": true,
      "hasBlockedNavigation": false,
      "hasMultipleQueryClients": false,
      "hasUnmemoizedRoutes": false,
      "hasReactRouter": true,
      "hasShellComponents": true,
      "componentCount": 0,
      "imports": [
        "react",
        "react-router-dom",
        "@tanstack/react-query",
        "@tanstack/react-query-devtools",
        "capitalrx-shell",
        "@/helpers",
        "@/hooks",
        "@/v2/api",
        "@/v2/hooks",
        "@/constants",
        "@/context",
        "./routes",
        "./ReactQueryDevtools.module.scss"
      ]
    },
    {
      "file": "frontend/src/routes/routes.ts",
      "hasActivityContext": false,
      "hasBlockedNavigation": false,
      "hasMultipleQueryClients": false,
      "hasUnmemoizedRoutes": false,
      "hasReactRouter": false,
      "hasShellComponents": false,
      "componentCount": 0,
      "imports": [
        "react"
      ]
    },
    {
      "file": "frontend/src/v2/components/Modals/RouteCaseForm.tsx",
      "hasActivityContext": false,
      "hasBlockedNavigation": false,
      "hasMultipleQueryClients": false,
      "hasUnmemoizedRoutes": false,
      "hasReactRouter": false,
      "hasShellComponents": false,
      "componentCount": 0,
      "imports": [
        "react",
        "capitalrx-components-2.0/lib/general",
        "capitalrx-components-2.0/lib/forms",
        "capitalrx-components-2.0/lib/layout",
        "capitalrx-components-2.0/lib/typography",
        "@/v2/context",
        "@/v2/pages"
      ]
    },
    {
      "file": "frontend/src/v2/pages/Letters/LetterRoutes.tsx",
      "hasActivityContext": false,
      "hasBlockedNavigation": false,
      "hasMultipleQueryClients": false,
      "hasUnmemoizedRoutes": false,
      "hasReactRouter": true,
      "hasShellComponents": false,
      "componentCount": 0,
      "imports": [
        "react",
        "react-router-dom",
        "@/v2/pages",
        "@/components",
        "@/constants"
      ]
    }
  ],
  "summary": {
    "filesAnalyzed": 6,
    "filesWithIssues": 2,
    "totalIssues": 4,
    "issuesByType": {
      "unmemoized-shell-hooks": 2,
      "query-client-creation": 1,
      "activity-context": 1
    },
    "issuesBySeverity": {
      "high": 0,
      "medium": 4,
      "low": 0
    }
  }
};

        
      // Tab functionality
      function showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.querySelectorAll('.tab').forEach(tab => {
          tab.classList.remove('active');
        });

        document.getElementById(tabName).classList.add('active');
        event.target.classList.add('active');
      }

      // Debug utilities
      const debugUtilities = {
        routeChanges: [],
        componentMounts: new Map(),
        startTime: Date.now(),
        monitoring: false,

        startMonitoring() {
          if (this.monitoring) return;

          this.monitoring = true;

          // Override history methods
          const originalPushState = history.pushState;
          const originalReplaceState = history.replaceState;

          history.pushState = (...args) => {
            this.logRouteChange('pushState', args[2] || location.pathname);
            return originalPushState.apply(history, args);
          };

          history.replaceState = (...args) => {
            this.logRouteChange('replaceState', args[2] || location.pathname);
            return originalReplaceState.apply(history, args);
          };

          window.addEventListener('popstate', (e) => {
            this.logRouteChange('popstate', location.pathname);
          });

          this.updateOutput('Route monitoring started');
        },

        stopMonitoring() {
          this.monitoring = false;
          this.updateOutput('Route monitoring stopped');
        },

        logRouteChange(type, path) {
          const change = {
            type,
            path,
            timestamp: Date.now(),
            elapsed: Date.now() - this.startTime,
          };

          this.routeChanges.push(change);
          this.updateMonitor(`${type}: ${path} (${change.elapsed}ms)`);
          this.updateOutput(`[${new Date().toLocaleTimeString()}] ${type}: ${path}`);

          // Check for issues
          this.checkForIssues(change);
        },

        checkForIssues(change) {
          const recent = this.routeChanges.filter(c => Date.now() - c.timestamp < 1000).length;

          if (recent > 3) {
            this.updateOutput('‚ö†Ô∏è WARNING: Rapid route changes detected - possible unmount/remount cycle');
          }

          if (this.routeChanges.length > 1) {
            const previous = this.routeChanges[this.routeChanges.length - 2];
            if (previous.path === change.path) {
              this.updateOutput('‚ö†Ô∏è WARNING: Navigation to same route - possible route instability');
            }
          }
        },

        updateMonitor(message) {
          const monitor = document.getElementById('monitor-content');
          if (monitor) {
            const line = document.createElement('div');
            line.textContent = new Date().toLocaleTimeString() + ': ' + message;
            monitor.appendChild(line);

            while (monitor.children.length > 10) {
              monitor.removeChild(monitor.firstChild);
            }
            monitor.scrollTop = monitor.scrollHeight;
          }
        },

        updateOutput(message) {
          const output = document.getElementById('debug-output');
          if (output) {
            output.innerHTML = message + '<br>' + output.innerHTML;
          }
        },

        injectUtilities() {
          const script = document.createElement('script');
          script.textContent = `
            // Route unmount debugger
            window.useRouteUnmountDebugger = function(componentName) {
              const mountTime = Date.now();
              console.log('üîç Component mounted:', componentName);

              return {
                componentName,
                mountTime,
                getRenderCount: () => 1,
                getLifespan: () => Date.now() - mountTime
              };
            };

            // Route configuration analyzer
            window.CapitalRxRouteDebugger = {
              analyzeRouteConfiguration: function(routes, modules) {
                console.log('üîç Analyzing routes:', routes);
                return window.routeDebugData || [];
              },
              diagnoseUnmountIssues: function(config) {
                console.log('üîç Diagnosing unmount issues:', config);
                return { issues: [], recommendations: [], severity: 'low' };
              }
            };

            console.log('‚úÖ CapitalRx debug utilities injected');
          `;
          document.head.appendChild(script);

          this.updateOutput('‚úÖ Debug utilities injected into page');
        },

        analyzeCurrentRoute() {
          const analysis = {
            pathname: location.pathname,
            search: location.search,
            hash: location.hash,
            routeChanges: this.routeChanges.length,
            moduleDetected: location.pathname.includes('/module/'),
            moduleId: location.pathname.includes('/module/') ? location.pathname.split('/module/')[1]?.split('/')[0] : null,
          };

          this.updateOutput('üìÑ Current route analysis: ' + JSON.stringify(analysis, null, 2));
          return analysis;
        },

        exportData() {
          const data = {
            timestamp: new Date().toISOString(),
            location: location.href,
            routeChanges: this.routeChanges,
            analysis: this.analyzeCurrentRoute(),
            originalAnalysis: window.routeDebugData,
          };

          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `route-debug-export-${Date.now()}.json`;
          a.click();
          URL.revokeObjectURL(url);

          this.updateOutput('üìÅ Debug data exported');
        }
      };

      // Global functions for buttons
      function startRouteMonitor() {
        document.getElementById('monitor').style.display = 'block';
        debugUtilities.startMonitoring();
      }

      function stopRouteMonitor() {
        document.getElementById('monitor').style.display = 'none';
        debugUtilities.stopMonitoring();
      }

      function injectDebugUtilities() {
        debugUtilities.injectUtilities();
      }

      function analyzeCurrentRoute() {
        debugUtilities.analyzeCurrentRoute();
      }

      function exportDebugData() {
        debugUtilities.exportData();
      }

      // Initialize
      console.log('üîß CapitalRx Route Debugger Report loaded');
      console.log('Debug data:', window.routeDebugData);
    
    </script>
</body>
</html>